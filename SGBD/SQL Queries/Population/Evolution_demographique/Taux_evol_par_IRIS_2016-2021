-- Taux d'Ã©volution par quartier IRIS entre 2016 et 2021 (Choisy-Vitry)

WITH pop_2016 AS (
    SELECT 
        IRIS,
        P16_POP as pop
    FROM POP_IRIS_2016
    WHERE IRIS IN ('940220102','940220105','940220106','940220107','940220108','940220109','940220110','940220111','940220112','940220113','940220114','940220201','940220202','940220203','940220204','940220205','940220206','940810101','940810102','940810103','940810104','940810105','940810106','940810107','940810108','940810109','940810110','940810111','940810112','940810113','940810201','940810202','940810203','940810204','940810205','940810206','940810207','940810208','940810209','940810210','940810211','940810212','940810301','940810302','940810303','940810304','940810305','940810306','940810307','940810308','940810309','940810310','940810311','940810312')
),
pop_2021 AS (
    SELECT 
        IRIS,
        P21_POP as pop
    FROM POP_IRIS_2021
    WHERE IRIS IN ('940220102','940220105','940220106','940220107','940220108','940220109','940220110','940220111','940220112','940220113','940220114','940220201','940220202','940220203','940220204','940220205','940220206','940810101','940810102','940810103','940810104','940810105','940810106','940810107','940810108','940810109','940810110','940810111','940810112','940810113','940810201','940810202','940810203','940810204','940810205','940810206','940810207','940810208','940810209','940810210','940810211','940810212','940810301','940810302','940810303','940810304','940810305','940810306','940810307','940810308','940810309','940810310','940810311','940810312')
)
SELECT 
    t21.IRIS,
    t16.pop as population_2016,
    t21.pop as population_2021,
    REPLACE(CAST((CAST(t21.pop AS FLOAT) - t16.pop) / NULLIF(t16.pop, 0) AS VARCHAR), '.', ',') as evolution_ratio
FROM pop_2021 t21
JOIN pop_2016 t16 ON t21.IRIS = t16.IRIS
ORDER BY t21.IRIS;