-- Évolution du taux de chômage par territoire (2010-2015-2021) - Suresnes, Hauts-de-Seine et Île-de-France
-- Source : Table PROFIL_complet_COM_2021 (INSEE)

WITH data AS (
  SELECT 
    CODGEO,
    CAST(P21_CHOM1564 AS FLOAT) as chom_2021,
    CAST(P21_ACT1564 AS FLOAT) as act_2021,
    CAST(P15_CHOM1564 AS FLOAT) as chom_2015,
    CAST(P15_ACT1564 AS FLOAT) as act_2015,
    CAST(P10_CHOM1564 AS FLOAT) as chom_2010,
    CAST(P10_ACT1564 AS FLOAT) as act_2010
  FROM PROFIL_complet_COM_2021
),
suresnes AS (
  SELECT 
    'Suresnes' as territoire,
    ROUND(chom_2021/act_2021 * 100, 1) as tx_2021,
    ROUND(chom_2015/act_2015 * 100, 1) as tx_2015,
    ROUND(chom_2010/act_2010 * 100, 1) as tx_2010
  FROM data
  WHERE CODGEO = '92073'
),
hauts_de_seine AS (
  SELECT 
    'Hauts-de-Seine' as territoire,
    ROUND(SUM(chom_2021)/SUM(act_2021) * 100, 1) as tx_2021,
    ROUND(SUM(chom_2015)/SUM(act_2015) * 100, 1) as tx_2015,
    ROUND(SUM(chom_2010)/SUM(act_2010) * 100, 1) as tx_2010
  FROM data
  WHERE CODGEO IN ('92002','92004','92007','92009','92012','92014','92019','92020','92022','92023','92024','92025','92026','92032','92033','92035','92036','92040','92044','92046','92047','92048','92049','92050','92051','92060','92062','92063','92064','92071','92072','92073','92075','92076','92077','92078')
),
ile_de_france AS (
  SELECT 
    'Île-de-France' as territoire,
    ROUND(SUM(chom_2021)/SUM(act_2021) * 100, 1) as tx_2021,
    ROUND(SUM(chom_2015)/SUM(act_2015) * 100, 1) as tx_2015,
    ROUND(SUM(chom_2010)/SUM(act_2010) * 100, 1) as tx_2010
  FROM data
  WHERE CODGEO IN ('75056','77001','77002','77003','77004','77005','77006','77007','77008','77009','77010','77011','77012','77013','77014','77015','77016','77018','77019','77020','77021','77022','77023','77024','77025','77026','77027','77029','77030','77031','77032','77033','77034','77035','77036','77037','77038','77039','77040','77041','77042','77043','77044','77045','77046','77047','77048','77049','77050','77051','77052','77053','77054','77055','77056','77057','77058','77059','77060','77061','77062','77063','77065','77066','77067','77068','77069','77070','77071','77072','77073','77075','77076','77077','77078','77079','77080','77081','77082','77083','77084','77085','77086','77087','77088','77089','77090','77091','77093','77094','77095','77096','77097','77098','77099','77100','77101','77102','77103','77104','77106','77107','77108','77109','77110','77111','77112','77113','77114','77115','77116','77117','77118','77119','77120','77121','77122','77123','77124','77125','77126','77127','77128','77129','77130','77131','77132','77133','77134','77135','77136','77137','77138','77139','77140','77141','77142','77143','77144','77145','77146','77147','77148','77150','77151','77152','77153','77154','77155','77156','77157','77158','77159','77161','77162','77163','77164','77165','77167','77168','77169','77171','77172','77173','77174','77175','77176','77177','77178','77179','77180','77181','77182','77183','77184','77185','77186','77187','77188','77190','77191','77192','77193','77194','77195','77196','77197','77198','77199','77200','77201','77202','77203','77204','77205','77206','77207','77208','77209','77210','77211','77212','77214','77215','77216','77217','77218','77219','77220','77221','77222','77223','77224','77225','77226','77227','77228','77229','77230','77231','77232','77233','77234','77235','77236','77237','77238','77239','77240','77241','77242','77243','77244','77245','77246','77247','77248','77249','77250','77251','77252','77253','77254','77255','77256','77257','77258','77259','77260','77261','77262','77263','77264','77265','77266','77267','77268','77269','77270','77271','77272','77273','77274','77275','77276','77277','77278','77279','77280','77281','77282','77283','77284','77285','77286','77287','77288','77289','77290','77291','77292','77293','77294','77295','77296','77297','77298','77300','77301','77302','77303','77304','77305','77306','77307','77308','77309','77310','77311','77312','77313','77314','77315','77316','77317','77318','77319','77320','77321','77322','77323','77325','77326','77327','77328','77329','77330','77331','77332','77333','77335','77336','77337','77338','77339','77340','77341','77342','77343','77344','77345','77347','77348','77349','77350','77352','77353','77354','77355','77356','77357','77358','77359','77360','77361','77363','77364','77365','77366','77367','77368','77369','77370','77371','77372','77373','77374','77376','77377','77378','77379','77380','77381','77382','77383','77384','77385','77386','77387','77388','77389','77390','77391','77392','77393','77394','77395','77396','77397','77398','77400','77401','77402','77403','77404','77405','77406','77407','77408','77409','77410','77411','77412','77413','77414','77415','77416','77417','77418','77419','77420','77421','77423','77424','77425','77426','77427','77428','77429','77430','77431','77432','77433','77434','77435','77436','77437','77438','77439','77440','77441','77442','77443','77444','77445','77446','77447','77448','77449','77450','77451','77452','77453','77454','77455','77456','77457','77458','77459','77460','77461','77462','77463','77464','77465','77466','77467','77468','77469','77470','77471','77472','77473','77474','77475','77476','77477','77478','77479','77480','77481','77482','77483','77484','77485','77486','77487','77489','77490','77492','77493','77494','77495','77496','77498','77500','77501','77504','77505','77506','77507','77508','77509','77510','77511','77512','77513','77514','77515','77516','77517','77518','77519','77520','77521','77522','77523','77524','77525','77526','77527','77528','77529','77530','77531','77532','77533','77534','78003','78005','78006','78007','78009','78010','78013','78015','78020','78029','78030','78031','78033','78034','78036','78043','78048','78049','78050','78053','78057','78062','78068','78070','78071','78072','78073','78076','78077','78082','78084','78087','78089','78090','78092','78096','78104','78107','78108','78113','78117','78118','78120','78123','78124','78125','78126','78128','78133','78138','78140','78143','78146','78147','78152','78158','78160','78162','78163','78164','78165','78168','78171','78172','78185','78188','78189','78190','78192','78193','78194','78196','78202','78206','78208','78209','78217','78220','78224','78227','78230','78231','78233','78234','78236','78237','78238','78239','78242','78245','78246','78255','78261','78262','78263','78264','78265','78267','78269','78276','78278','78281','78283','78285','78289','78290','78291','78296','78297','78299','78300','78302','78305','78307','78310','78311','78314','78317','78320','78321','78322','78324','78325','78327','78329','78334','78335','78337','78343','78344','78346','78349','78350','78354','78356','78358','78361','78362','78364','78366','78367','78368','78372','78380','78381','78382','78383','78384','78385','78389','78391','78396','78397','78398','78401','78402','78403','78404','78406','78407','78410','78413','78415','78416','78417','78418','78420','78423','78431','78437','78439','78440','78442','78443','78444','78451','78455','78460','78464','78465','78466','78470','78472','78474','78475','78478','78481','78484','78486','78490','78497','78498','78499','78501','78502','78505','78506','78513','78516','78517','78518','78520','78522','78528','78530','78531','78536','78537','78545','78548','78550','78551','78557','78558','78559','78561','78562','78564','78565','78567','78569','78571','78575','78576','78586','78588','78590','78591','78597','78601','78605','78606','78608','78609','78615','78616','78618','78620','78621','78623','78624','78638','78640','78642','78643','78644','78646','78647','78650','78653','78655','78668','78672','78674','78677','78681','78683','78686','78688','91001','91016','91017','91021','91022','91027','91035','91037','91038','91041','91044','91045','91047','91064','91067','91069','91075','91079','91080','91081','91085','91086','91093','91095','91097','91098','91099','91100','91103','91105','91106','91109','91111','91112','91114','91115','91121','91122','91129','91130','91131','91132','91135','91136','91137','91145','91148','91156','91159','91161','91174','91175','91179','91180','91184','91186','91191','91195','91198','91200','91201','91204','91207','91215','91216','91223','91225','91226','91228','91232','91235','91240','91243','91244','91247','91248','91249','91272','91273','91274','91275','91284','91286','91292','91293','91294','91312','91315','91318','91319','91326','91330','91332','91333','91338','91339','91340','91345','91347','91359','91363','91374','91376','91377','91378','91386','91390','91393','91399','91405','91408','91411','91412','91414','91421','91425','91432','91433','91434','91435','91441','91457','91458','91461','91463','91468','91469','91471','91473','91477','91479','91482','91494','91495','91507','91508','91511','91514','91519','91521','91525','91526','91533','91534','91538','91540','91544','91546','91547','91549','91552','91553','91556','91560','91568','91570','91573','91577','91578','91579','91581','91587','91589','91593','91599','91600','91602','91613','91617','91619','91629','91630','91631','91634','91635','91639','91645','91648','91649','91654','91657','91659','91661','91662','91665','91666','91667','91671','91679','91685','91687','91689','91691','91692','92002','92004','92007','92009','92012','92014','92019','92020','92022','92023','92024','92025','92026','92032','92033','92035','92036','92040','92044','92046','92047','92048','92049','92050','92051','92060','92062','92063','92064','92071','92072','92073','92075','92076','92077','92078','93001','93005','93006','93007','93008','93010','93013','93014','93015','93027','93029','93030','93031','93032','93033','93039','93045','93046','93047','93048','93049','93050','93051','93053','93055','93057','93059','93061','93062','93063','93064','93066','93070','93071','93072','93073','93074','93077','93078','93079','94001','94002','94003','94004','94011','94015','94016','94017','94018','94019','94021','94022','94028','94033','94034','94037','94038','94041','94042','94043','94044','94046','94047','94048','94052','94053','94054','94055','94056','94058','94059','94060','94065','94067','94068','94069','94070','94071','94073','94074','94075','94076','94077','94078','94079','94080','94081','95002','95008','95011','95012','95014','95018','95019','95023','95024','95026','95028','95039','95040','95042','95046','95051','95052','95054','95055','95056','95058','95059','95060','95061','95063','95074','95078','95088','95091','95094','95101','95102','95110','95116','95119','95120','95127','95134','95139','95141','95142','95144','95149','95150','95151','95154','95157','95166','95169','95170','95176','95177','95181','95183','95197','95199','95203','95205','95210','95211','95212','95213','95214','95218','95219','95229','95241','95250','95252','95253','95254','95256','95257','95258','95268','95270','95271','95277','95280','95287','95288','95295','95298','95301','95303','95304','95306','95308','95309','95313','95316','95323','95328','95331','95341','95348','95351','95352','95353','95355','95365','95369','95370','95371','95379','95387','95388','95392','95394','95395','95409','95422','95424','95426','95427','95428','95429','95430','95436','95438','95445','95446','95447','95450','95452','95456','95459','95462','95476','95480','95483','95487','95488','95489','95491','95492','95493','95500','95504','95509','95510','95523','95527','95529','95535','95539','95541','95543','95554','95555','95563','95566','95572','95574','95580','95582','95584','95585','95592','95594','95598','95604','95607','95610','95611','95612','95625','95627','95628','95633','95637','95641','95651','95652','95656','95658','95660','95675','95676','95678','95680','95682','95690')
)
SELECT 
  territoire,
  tx_2010 as "2010",
  tx_2015 as "2015", 
  tx_2021 as "2021"
FROM (
  SELECT * FROM suresnes
  UNION ALL 
  SELECT * FROM hauts_de_seine
  UNION ALL
  SELECT * FROM ile_de_france
)
ORDER BY territoire;